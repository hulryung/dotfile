- defaults:
    link:
      relink: true
      create: true
    shell:
      stdout: true
      stderr: true

- clean:
    ~/:
      force: true
    ~/.config:
      recursive: true
      force: true

- create:
    - ~/.config

- shell:
    - command: |
        SUDOERS_FILE="/etc/sudoers.d/${USER}"
        if [ -f "$SUDOERS_FILE" ] && grep -q "NOPASSWD" "$SUDOERS_FILE"; then
          echo "NOPASSWD already configured for ${USER}"
        else
          echo "${USER} ALL=(ALL) NOPASSWD: ALL" | sudo tee "$SUDOERS_FILE" >/dev/null
          sudo chmod 0440 "$SUDOERS_FILE"
          echo "NOPASSWD configured for ${USER}"
        fi
      description: Configuring sudoers NOPASSWD
      quiet: true
      stdin: true
      stdout: true
      stderr: true
    - command: |
        if ! command -v brew &>/dev/null; then
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        else
          echo "Homebrew is already installed ($(brew --version | head -n1))"
        fi
        # Ensure brew is on PATH after install
        if [ -d /home/linuxbrew/.linuxbrew ]; then
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
        elif [ -d /opt/homebrew ]; then
          eval "$(/opt/homebrew/bin/brew shellenv)"
        elif [ -d /usr/local/Homebrew ]; then
          eval "$(/usr/local/bin/brew shellenv)"
        fi
      description: Installing Homebrew
      quiet: true
      stdin: true
      stdout: true
      stderr: true
    - command: |
        # Ensure brew is on PATH
        if [ -d /home/linuxbrew/.linuxbrew ]; then
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
        elif [ -d /opt/homebrew ]; then
          eval "$(/opt/homebrew/bin/brew shellenv)"
        elif [ -d /usr/local/Homebrew ]; then
          eval "$(/usr/local/bin/brew shellenv)"
        fi
        for pkg in node jq gemini-cli; do
          if brew list "$pkg" &>/dev/null; then
            echo "$pkg is already installed"
          else
            brew install "$pkg"
          fi
        done
      description: Installing common brew packages (node, jq, gemini-cli)
      quiet: true
      stdin: true
      stdout: true
      stderr: true
    - command: ./scripts/install_starship.sh
      description: Installing Starship prompt (nerd-font-symbols preset)
      quiet: true
      stdin: true
      stdout: true
      stderr: true
    - command: npx github:hulryung/cc-statusline init
      description: Setting up cc-statusline for Claude Code (forked)
      quiet: true
      stdin: true
      stdout: true
      stderr: true
